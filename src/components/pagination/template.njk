  {% set totalPages = params.items | length %}

  {% set firstPage = params.items | first %}
  {% set lastPage = params.items | last %}

  {% set firstPage = firstPage.text %}
  {% set firstPageNum = firstPage | int %}
  {% set lastPage = lastPage.text %}
  {% set lastPageNum = lastPage | int %}

  {# Calculate middle pages #}
  {% set middlePagesEachSide = (params.maxLength - 1) / 2 %}

  {% if (params.page - middlePagesEachSide) <= 1 %}
      {% set middlePagesStart = 1 | round(0, "floor") %}
      {% set middlePagesEnd = params.maxLength + 1 | round(0, "floor") %}
  {% elif (params.page + middlePagesEachSide) >= totalPages %}
      {% set middlePagesStart = totalPages - params.maxLength + 1 | round(0, "floor") %}
      {% set middlePagesEnd = totalPages | round(0, "floor") %}
  {% else %}
      {% set middlePagesStart = params.page - middlePagesEachSide | round(0, "floor") %}
      {% set middlePagesEnd = params.page + middlePagesEachSide | round(0, "floor") %}
  {% endif %}

  {% if params.maxLength % 2 == 0 %}
    {% set middlePagesEnd = middlePagesEnd + 1 %}
  {% endif %}

  {# show start truncation #}
  {% if params.page > 4 %}
    {% set showTruncationStart = true %}
    {% if middlePagesStart <= 3 %}
      {% set showTruncationStart = false %}
      {% set middlePagesStart = 1 %}
    {% endif %}
  {% endif %}

  {# show end truncation #}
  {% if middlePagesEnd + 1 !== lastPageNum and params.page < totalPages - 3 %}
    {% set showTruncationEnd = true %}
    {% if totalPages - middlePagesEnd <= 2 %}
      {% set showTruncationEnd = false %}
      {% set middlePagesEnd = middlePagesEnd + (totalPages - middlePagesEnd) %}
    {% endif %}
  {% endif %}

  <aside>
    <span>Total pages - {{ totalPages }}</span>
    <span>Middle start - {{ middlePagesStart }}</span>
    <span>Middle pages end - {{ middlePagesEnd }}</span>
    <span>Middle pages each side - {{ middlePagesEachSide }}</span>
  </aside>

{% if totalPages !== 0 %}
  <nav class="hmrc-pagination">
  <ul class="hmrc-pagination__list">

  {# Previous Button #}
  {% if params.page != 1 %}<li class="hmrc-pagination__item  hmrc-pagination__item--prev"><a class="hmrc-pagination__link" href="previous">Previous</a></li>{% endif %}

  {# First page and truncation #}
  {% if middlePagesStart !== firstPageNum and params.page > 3 %}
    <li class="hmrc-pagination__item hmrc-pagination__page">
      <a href="{{ firstPage.href }}" class="hmrc-pagination__link">{{ firstPage | safe }}</a>
    </li>
  {% endif %}

  {% if showTruncationStart %}
    <li class="hmrc-pagination__item hmrc-pagination__item--dots">...</li>
  {% endif %}

  {# Main pages #}
  {% for item in params.items -%}
    {% if loop.index >= middlePagesStart and loop.index <= middlePagesEnd %}
      {% set isActiveItem = loop.index == params.page %}
      <li class="hmrc-pagination__item hmrc-pagination__page {% if isActiveItem %} govuk-!-font-weight-bold hmrc-pagination__item--active {% endif %}">{% if not isActiveItem %}<a class="hmrc-pagination__link" href="{{ item.href | urlencode }}">{% endif %} {{ item.text | safe }} {% if not isActiveItem %}</a>{% endif %}</li>
    {% endif %}
  {%- endfor %}

  {# Last page and truncation #}
  {% if showTruncationEnd %}
    <li class="hmrc-pagination__item hmrc-pagination__item--dots">&hellip;</li>
  {% endif %}

  {% if middlePagesEnd !== lastPageNum and params.page < totalPages - 2 %}
    <li class="hmrc-pagination__item hmrc-pagination__page">
      <a href="{{ lastPage.href }}" class="hmrc-pagination__link">{{ lastPage | safe }}</a>
    </li>
  {% endif %}

  {# Next button #}
  {% if params.page != totalPages %}<li class="hmrc-pagination__item  hmrc-pagination__item--next"><a class="hmrc-pagination__link" href="next">Next</a></li>{% endif %}
  </ul>
  </nav>

  {% endif %}
